---
title: "Implementing security proxy based security"
date: 2018-02-17 12:00
layout: "single"
categories: "ContentEngine"
excerpt: "This article will show how you can use change preprocessors to implement a security scheme based on security proxies for the FileNet P8 Content Engine."
---

This article will show how you can use change preprocessors to implement a security scheme based on security proxies.

Security proxies are object store objects that control the security of other object store objects by means of security inheritance. Usually custom objects are used for this purpose, but folders and documents can also act as security proxies. To configure this behavior, you first start with an object-valued property template. In the advanced section you can specify that this property should act as a security proxy (it's a good practice to make this property hidden as well):

![security-proxy-type]({{ site.url }}/img/posts/security-proxy-type.png)<br/>
Next you assign this property template to the object you want to control, either a document,folder or a custom object. Now all  *inheritable* security of the proxy object will be enforced on the object it is assigned to. The security proxy type controls this behavior. A value of two means *Inherit*, meaning that the proxy security is added to the existing security of the object. You can also use a value of one (not in the dropdown list when defining the property template), with the name *Full Proxy*, meaning the security on the object will be replaced by the security of the proxy.

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="611px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/604.5.6 (KHTML, like Gecko) Version/11.0.3 Safari/604.5.6&quot; version=&quot;8.2.1&quot; editor=&quot;www.draw.io&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;159b54fb-2b64-4453-2398-dd5f3e4b0b70&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 611 561" style="cursor:pointer;max-width:100%;max-height:561px;"><defs><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffffff-1-b3b3b3-1-s-0"><stop offset="0%" style="stop-color:#ffffff"/><stop offset="100%" style="stop-color:#b3b3b3"/></linearGradient></defs><g transform="translate(0.5,0.5)"><rect x="0" y="0" width="290" height="560" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(66.5,27.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="156" height="24" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 22px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 157px; white-space: nowrap; word-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Custom Object</div></div></foreignObject><text x="78" y="23" fill="#000000" text-anchor="middle" font-size="22px" font-family="Helvetica" font-weight="bold">Custom Object</text></switch></g><rect x="320" y="0" width="290" height="560" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(410.5,27.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="108" height="24" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 22px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 109px; white-space: nowrap; word-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Document</div></div></foreignObject><text x="54" y="23" fill="#000000" text-anchor="middle" font-size="22px" font-family="Helvetica" font-weight="bold">Document</text></switch></g><path d="M 270 250 L 335 250" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 270 370 L 335 370" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><rect x="10" y="80" width="260" height="100" fill="#ffffff" stroke="#000000" pointer-events="none"/><image x="19.5" y="99.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(84.5,79.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="163" height="83" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 164px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Admins</h1><p style="font-size: 14px"><font style="font-size: 14px">Full Control for</font><span> this object.</span></p></div></div></foreignObject><text x="82" y="47" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="10" y="200" width="260" height="100" fill="#ffffff" stroke="#000000" pointer-events="none"/><image x="19.5" y="219.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(84.5,199.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="90" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 180px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Editors</h1><p style="font-size: 14px"><font style="font-size: 14px">Major versioning rights for a</font><span>ll children,but not this object.</span></p></div></div></foreignObject><text x="90" y="51" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="10" y="320" width="260" height="100" fill="#ffffff" stroke="#000000" pointer-events="none"/><image x="19.5" y="339.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(84.5,319.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="90" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 180px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Viewers</h1><p style="font-size: 14px"><font style="font-size: 14px">Viewing rights for a</font><span>ll children,but not this object.</span></p></div></div></foreignObject><text x="90" y="51" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="335" y="200" width="260" height="100" fill="url(#mx-gradient-ffffff-1-b3b3b3-1-s-0)" stroke="#666666" stroke-dasharray="3 3" pointer-events="none"/><rect x="335" y="200" width="260" height="100" fill="#ffffff" stroke="#000000" stroke-dasharray="3 3" pointer-events="none"/><image x="344.5" y="219.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" opacity="0.6" pointer-events="none"/><g transform="translate(409.5,199.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="90" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 180px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Editors</h1><p style="font-size: 14px"><font style="font-size: 14px">Major versioning rights for a</font><span>ll children.</span></p></div></div></foreignObject><text x="90" y="51" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="335" y="320" width="260" height="100" fill="#ffffff" stroke="#000000" stroke-dasharray="3 3" pointer-events="none"/><image x="344.5" y="339.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" opacity="0.6" pointer-events="none"/><g transform="translate(409.5,319.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="90" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 180px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Viewers</h1><p style="font-size: 14px"><font style="font-size: 14px">Viewing rights for a</font><span>ll children.</span></p></div></div></foreignObject><text x="90" y="51" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="335" y="440" width="260" height="100" fill="#ffffff" stroke="#000000" pointer-events="none"/><image x="344.5" y="459.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(409.5,439.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="145" height="83" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 146px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Creator</h1><p style="font-size: 14px"><font style="font-size: 14px">Major versioning rights</font><span>.</span></p></div></div></foreignObject><text x="73" y="47" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="15" y="440" width="260" height="100" fill="#ffffff" stroke="#000000" pointer-events="none"/><image x="24.5" y="459.5" width="60" height="60" xlink:href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-stalker-128.png" preserveAspectRatio="none" pointer-events="none"/><g transform="translate(89.5,439.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="99" height="83" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; overflow: hidden; max-height: 90px; max-width: 180px; width: 100px; white-space: normal; word-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><h1>Everyone</h1><p style="font-size: 14px"><font style="font-size: 14px">Viewing rights</font><span>.</span></p></div></div></foreignObject><text x="50" y="47" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>

The diagram shows how this works with an example. The *Admins* group is given full control of the proxy object, but no inheritable security. This group can configure the security proxy object, but will require no extra rights on the objects it   controls . On the other hand, the *Editors* group and the *Viewer* groups have no extra rights on the proxy object (the "but not this object" part), but will gain extra rights on the document object. In this example we don't use a full proxy, so the existing rights of the creator will still be valid. Finally we give a group containing everybody viewing rights on the proxy object. They should be able to find them if they want to use them.

## Configuring the data model

We saw in the previous section that you have to do some configuration if you want to use security proxies. So first the data model surrounding our implementation of security proxies will be discussed. We will use a simple scheme depicted by the following diagram:

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="491px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/604.5.6 (KHTML, like Gecko) Version/11.0.3 Safari/604.5.6&quot; version=&quot;8.2.1&quot; editor=&quot;www.draw.io&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;91588a93-7761-902c-2c04-9cb46bdd4ba1&quot; name=&quot;Page-1&quot;&gt;7Zjdc9o4EMD/Gj+WsSQDziM4yfUhnWaOu7m7R8VesK6yxcgikP71t7IljD9CuZZ+zLQZJlhr7Vq7+/NqRcCS4vCb5tv8ncpABjTMDgG7DSi9mYf43wpeGsEsumkEGy2yRkRawUp8BCd0epudyKDqTDRKSSO2XWGqyhJS05FxrdW+O22tZPepW76BgWCVcjmU/iUykzfSmM5a+VsQm9w/mcycfwX3k50nVc4ztT8RsbuAJVop01wVhwSkjZ2PS6N3/8rd48I0lOYSBdooPHO5c77dAmqbAvVvVbqz326l5sW7X+1FIXmJo+ValWbl7oQ4TnMhswf+onb28ZXh6Qc/WuZKi484n0u8RVCAt7Vx2cXYoTUhZaKk0igoVf2AVmlljbnHaKhQ7dG7SXqid/zQmfjAK+MXqKTk20o81Uu2igXXG1EulTGqcJO8g/cn6wkoW9d/1qralRlkfrbPYWO/EKm7tsG554WQFvO3IJ/BiJT7qDV+kwjHLgmgDRxeTSQ54oGvFagCjH7BKf6dckC5N4p4wPYtn3TqZHmHTYcAd+/E5mi6xQYvHDnjFM1nIY1iHs4jyuZTyt7cDLCaTCbvTQ7aOqXVFl0VUKFwABeGwNRsaPUBejCM8MGl2JQ4TDFOaJ0tbRQxynLhbhi1tea2PBXl5gHW1u+olfzuQmFFCnXXsk5lLrIMyjrVhhv+dAR8q0Rp6lBNl/jBiCbhZBpMcekJjkk7xo+drk2iSvSGizqRgCjuweJ4jqKMV3l9h3xVpOg4Uo4hX84+hZCfd1WC4gFBA1KkqAloSPF1mJzHRNYADCApMN0SWir+sNDcviEDctiQHDZCieRPIB9VJYxQ1r5u5vbo+W6AsOsAMqWXARJ/OR9sBAd0IWx3q4AtcLwyGlMTWCTZgR/d/PL68go4P251+QoFYXbhnnKNghCNJjyhweIk54s0hapqMp/sKruB0/D907+25/uV96vlPf6GG8FskPc/KxgkE8psYft4HGEvYSOKEu817dfH3BS+5byoPJLaHi78b5ueSUiPgn9qAZlGXvAIWqCPtvOoEwkHYawWmYRh7MaNEmXEjfs6jXeQDc4cvd4PDznYqkK3qFZqp1M4eWeGWTxJG/GvsAbJjXjuPnEsb87cowW07TYZ7bWb3q430SzLaZ2eP3qGovgThhqXB4ZqjI4+XtZinDnquELy66AT/PAHnaiPXjzsQo4UnVan+RXakLGu9Fwb8pPuQZ4N8rkIzP/vwWQ049fYj2IOQNZ8DRlhlExHzyWWACzqhagqbPddP7JI7lyT/7NS8F2Kx3lyRk4s1yIHh+3Pds321P72ye7+Aw==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 491 144" style="cursor:pointer;max-width:100%;max-height:144px;"><defs><clipPath id="mx-clip-4-31-242-26-0"><rect x="4" y="31" width="242" height="26"/></clipPath><clipPath id="mx-clip-4-65-242-26-0"><rect x="4" y="65" width="242" height="26"/></clipPath><clipPath id="mx-clip-4-91-242-26-0"><rect x="4" y="91" width="242" height="26"/></clipPath><clipPath id="mx-clip-334-93-152-26-0"><rect x="334" y="93" width="152" height="26"/></clipPath><clipPath id="mx-clip-334-119-152-26-0"><rect x="334" y="119" width="152" height="26"/></clipPath></defs><g transform="translate(0.5,0.5)"><rect x="0" y="0" width="250" height="112" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 0 26 L 0 0 L 250 0 L 250 26 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="14px"><text x="124.5" y="18.5">DepartmentDocument</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-4-31-242-26-0)" text-anchor="middle" font-size="14px"><text x="124.5" y="45.5">...Other properties...</text></g><path d="M 0 56 L 250 56" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-4-65-242-26-0)" font-size="14px"><text x="5.5" y="79.5">+ Department: String</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-4-91-242-26-0)" font-size="14px"><text x="5.5" y="105.5">+ DepartmentAccess: Custom Object</text></g><path d="M 252 92 L 330.76 92" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 318.88 98.5 L 331.88 92 L 318.88 85.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(282.5,86.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="20" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">Use</div></div></foreignObject><text x="10" y="11" fill="#000000" text-anchor="middle" font-size="11px" font-family="Helvetica">Use</text></switch></g><rect x="330" y="62" width="160" height="78" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 330 88 L 330 62 L 490 62 L 490 88 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="14px"><text x="409.5" y="80.5">DepartmentAccess</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-334-93-152-26-0)" font-size="14px"><text x="335.5" y="107.5">+ Department: String</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-334-119-152-26-0)" font-size="14px"><text x="335.5" y="133.5">+ Permissions: ACE[]</text></g></g></svg>

The class `DepartmentAccess` defines a custom object containing the desired security of the documents of the different departments within the organization. For every department within the organization an instance of this class is created, identified by the name property `Department`. This property is coupled to a choice list containing all the departments. The access rights on the security proxy can be as complex as you like, for instance giving modification rights to the members of the department but only viewing rights for the rest of the organization. Make sure that you define access control entries that can be inherited.

On the other side the document class called `DepartmentDocument` is used for documents that are controlled by the security proxy. Two properties play a role controlling the security of the document:
* The property `Department` is a required string valued property that contains the department the document belongs to. This property is also coupled to the choice list containing all the departments.
* The property `DepartmentAccess` acts as the security proxy object. This is a hidden required object valued property accepting instances of `DepartmentAccess` as a value.

## Selecting a server side extension

Now that we have our static data model in place it is time to describe the dynamic behavior. The challenge in this situation is to keep the two property values defined for the `DepartmentDocument` synchronized. The value of the `Department` property is set by the client application and the server must update the value of the `DepartmentAccess` property accordingly. There are two ways to implement this behavior with a server side extension. Because a property value of the document must be updated we have a choice between an asynchronous event action and a change preprocessor. My opinion is that a change preprocessor is the better way to do it. The reasoning behind this is that with a change preprocessor the new security is immediately present on the new or changed document but with an asynchronous event action it will take a fraction before the security is applied. This fraction can become significantly larger if something goes wrong. Consider for instance the situation where a security proxy is missing from the object store for a specific department. An asynchronous event action handler can at most notify this to an administrator in a log-file on the server, but the document will still contain incorrect security. A change preprocessor runs synchronously and can report this condition directly to the client by throwing a Java exception. This way the integrity of the security is maintained because the whole transaction is now rolled back.

> In IBM Content Navigator the cause of an exception in a change preprocessor is reported to the end user with the following dialog:
![save-error]({{ site.url }}/img/posts/save-error.png)<br/>
This dialog is very vague and needs some improvement!

Now that I hope that you are convinced that a change preprocessor can be used to solve this problem, we will now look at the actual implementation.

## Implementing the change preprocessor

The implementation of the change preprocessor is shown below. There are five different functions, each implementing a specific part of the requirements.

{% gist rickx1/069179d79872f7d7c6a89f2ba69241a3 %}

The main entry point is the `preprocessObjectChange()` method.  This is the method that is called by the server when the object is changed. This method calls the `getDepartment()` method  to get the property object containing the value of the department property. This `getDepartment()` method returns a null value if the department property is not present in the property collection. Next, the `preprocessObjectChange()` method performs a null check and a dirty check on the department property object before the `updateSecurityProxy()` method  is called. This method has two arguments, the source object and the value of the department property. The responsibility of this method is to set the value of the security proxy property `DepartmentAccess`. The value of this property is provided by the `getDepartmentAccess()` method, which takes the value of the department property and the object store as its arguments.  This method uses the `searchDepartmentAccess()` method  to query for a security proxy object with a matching department name. If no matching security proxy object is found a runtime exception is thrown, triggering a rollback of the whole transaction. Instead of a search the security proxy object can also be accessed by path. However in that case an exception is thrown when the object cannot be found. This exception must be caught to provide a more meaningful message to the user. Therefore a search is in this case a more elegant solution.

The search also provides opportunities for further expansion of this simple example. In this case, the value of the department property is used as the key to a specific security proxy. You can however use a more elaborate scheme where more properties of the source object play a role finding the corresponding security proxy. You could for instance add a status property to the source object’s class definition with “open” and “close” as accepted values. Now the inherited security of an object with the status “open” can differ from  an object with the status “closed”. Also in this extended case the change preprocessor handler will make sure that the source object will always have the correct security.

## Final Thoughts

Implementing security based on security proxies can gives you a flexible system which is still very maintainable. However it needs careful planning and design, you don't want to do a security conversion once your system is in place. When I design these systems I normally use the feature that a custom object can also be controlled by another custom object, giving you the possibility to chain proxy objects.

Keep in mind that for a maintainable system you should also write code to create and update the security proxy objects. Creating the proxy objects by hand is *not* a good idea. Usually I use an Excel sheet serving as the input of a Java program creating the proxies.
